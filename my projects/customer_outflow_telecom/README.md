# Прогнозирование оттока клиентов Телеком компании


## Описание задачи

Необходимо создать модель по прогнозированию оттока клиентов для Телеком компании. 
В случае, если выяснится, что пользователь планирует уйти, ему будут предложены промокоды и специальные условия. 
По собранным данным о некоторых клиентах, информации об их тарифах и договорах необходимо обучить модели 
для прогнозирования факта ухода клиента.

## План работы

Просмотр исходных данных о клиентах и их контрактах, состоящих из четырех датасетов.

Исследовательский анализ данных:

- приведение столбцов к змеиному регистру,

- просмотр на наличие пропусков в данных и выбросов,

- добавление новых столбов при необходимости,

- изменение типов данных,

- просмотр распределения данных,

- удаление столбцов, не несущих смысловую нагрузку,

- склеивание всех таблиц в единую таблицу.

Предобработка данных перед обучением:

- кодирование категориальных признаков,

- разделение данных на фичи и таргет (классы должны быть сбалансированы),

- разбиение на обучающую и тестовую выборки,

- масштабирование фичей,

- проверить признаки на наличие корреляции.

Обучение моделей:

- использование следующих ML моделей: RandomForestClassifier, DecisionTreeClassifier, LogisticRegression, LGBMClassifier, CatBoostClassifier, XGBClassifier

- поиск лучших гиперпараметров моделей с помощью RandomizedSearchCV либо GridSearchCV.

Проверка лучших моделей на тестовой выборке:

- сравнение полученных результатов с базовой моделью,

- построение таблиц важности признаков.

Выводы


## ОТЧЁТ:
В данном проекте было необходимо создать модель по прогнозированию оттока клиентов для Телеком компании.

1. В нашем распоряжении было четыре датасета: 


данные о контрактах (df_contract), содержащие такие столбцы, как:

    * customerID - ID клиента
    * BeginDate - дата начала пользования услугами
    * EndDate    - дата окончания пользования услугами 
    * Type - тип контракта
    * PaperlessBilling - (вероятно) вариант предоставления счета - бумажные или нет
    * PaymentMethod - способ оплаты
    * MonthlyCharges - ежемесячный платеж
    * TotalCharges - общая сумма платежей
    
    
данные о клиентах (df_person):

    * customerID - ID клиента
    * gender - пол клиента
    * SeniorCitizen - пенсионер или нет
    * Partner - наличие гражданского мужа/жены
    * Dependents - есть ли кто-то на иждивении 
    
    
данные о подключённых интернет услугах (df_internet):

    * customerID - ID клиента
    * InternetService - технология доступа в интернет
    * OnlineSecurity - доп. услуга 
    * OnlineBackup   - доп. услуга 
    * DeviceProtection - доп. услуга 
    * TechSupport - доп. услуга 
    * StreamingTV - доп. услуга 
    * StreamingMovies - доп. услуга 
    
    
данные о телефонии (df_phone):

    * customerID - ID клиента
    * MultipleLines - возможность многоканальных звонков

Все четыре таблицы были объединены по идентификатору клиента внешним образом. Получившиеся пропуски в столбце ‘MultipleLines ’ были заполнены значением ‘Unknown’ - факт того, что клиент не пользуется телефонией. Пропуски в столбцах, относящихся к интернету были заменены на ‘No’.

Целевой признак был выделен из таблицы df_contract, как факт ухода клиента (‘churn’): 0 если в столбце EndDate не стоит даты ухода и 1 если дата ухода есть.

Также был создан новый столбец - ‘days’ - длительность контракта в днях. Данный столбец был получен как разность между датой завершения контракта, если таковая есть, или 1 февраля 2020 года (дата выгрузки данных) и датой начала. 

2. Далее был проведён исследовательский анализ данных:

- столбцы приведены к змеиному регистру;
- было найдено и удалено 11 пропусков в столбце ‘total_charges’;
- типы столбцов, содержащих количественные данные, были заменены на float;
- выбросов в данных в столбцах ‘total_charges’ и ‘monthly_charges’ обнаружено не было;
- но было отмечено, что среднее значение платежа у ушедших больше. Также можно отметить, что у оставшихся разброс значений платежа большой, в то время, как у ушедших значения ежемесячного платежа более компактны. 
- с помощью библиотеки Sweetwiz был создан отчёт о взаимозависимости данных, 
-  cтолбцы, относящиеся к датам (EndDate и BeginDate), а также ‘Total_Charges’ были удалены из итогового датафрейма во избежание улички данных.
- дубликаты в количестве 23 штук были удалены.

Всего на этом этапе в итоговом датафрейме - 7009 строк и 18 столбцов. 

3. Была проведена предобработка данных перед обучением:

- категориальные признаки были кодированы с помощью OHE (Ordinal Encoder в нашем случае не подходит, тк в обучении предполагается использовать линейные модели),
- данные были разделены на фичи и таргет;
- было произведено разбиение на обучающую и тестовую выборки в отношении 4:1 с использованием параметра stratify для сбалансированности классов;
- масштабирование признаков производилось с использованием StandardScaler.  RobustScaler и MinMaxScaler для нашей задачи не подходили;
- проверка признаков на наличие корреляции производилась с использованием коэффициента Phik. 

Всего на этом этапе в итоговом датафрейме - 7009 строк и 22 столбца. 

4. Для обучения были использованы следующие ML модели: RandomForestClassifier, DecisionTreeClassifier, LogisticRegression, LGBMClassifier, CatBoostClassifier, XGBClassifier.
- поиск лучших гиперпараметров моделей осуществлялся с помощью RandomizedSearchCV;
- в качестве скоринга рассчитывались метрики: ROC-AUC, accuracy, f1, precision, recall. Первая определялась как наиболее важная;
- по результатам обучения моделей была создана сводная таблица, содержащая значения метрик и наилучшие параметры моделей, время обучения моделей. 
- наилучший результат ROC-AUC = 0.9195 показала модель LGBM.
- был построен соответствующий график вместе с графиком базовой модели;
- была построена гистограмма важности признаков, наиболее важными оказались ‘days’ и ‘monthlt_charges’. 

6.  Эксперимент 1:

В качестве эксперимента было решено удалить большинство неважных для модели признаков и оставить лишь 6 наиболее важных: 'monthly_charges', 'days', 'paperless_billing_Yes', 'tech_support_Yes', 'multiple_lines_Yes', 'type_One year'. 

   - была произведена необходимая подготовка данных и модель LGBM была обучена еще раз на новых данных.
   - получили метрику чуть выше, чем было! ROC-AUC = 0.9239
   
Эксперимент 2: 

- оставили только два самых важных признака: 'monthly_charges' и 'days' и снова обучили модель;
- получили метрику чуть-чуть хуже, чем с 6 признаками, но лучше, чем с 22 признаками. ROC-AUC = 0.9232

Получается, что с двумя признаками модель работает немного хуже, чем с шестью, но даже чуть лучше, чем с 22 признаками. Много признаков создают шум. 

Вывод:

Таким образом, типичный портрет уходящего клиента таков: 

-  Он пришел к пройвайдеру в последние несколько лет.
-  Он пользуется интернетом. 
-  Интернетом он пользуется по оптоволокну.
-  По мимо интернета он также пользуется телефонией с возможностью многоканальных звонков. 
-  Вариативность оказываемых услуг для клиента не важна, важна лишь стоимость. 

Если зацепить клиента на некоторый срок у провайдера, то вероятность его ухода снижается. 
Получается, что как раз для новеньких клиентов очень актуально устраивать акции и сперпредложения с целью удержания. 
